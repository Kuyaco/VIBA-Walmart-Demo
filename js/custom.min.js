$( document ).ready(function() {

	if (window.matchMedia("(max-width: 767px)").matches){ $('html').removeClass('tabletDesktop'); $('html').addClass('mobileDevice')} else { $('html').removeClass('mobileDevice'); $('html').addClass('tabletDesktop')};	
	
	function closeStopVideo (selector) {
		$(selector).click(function(){
			let vURL = new URL($(this).parent().find('iframe').attr('src'));
			let vParams = vURL.searchParams;
			vParams.set('autoplay', '0');
			vURL.search = vParams.toString();
			let nURL = vURL.toString();
			$(this).parent().find('iframe').attr('src', nURL);
		});
	};
	closeStopVideo('.popup-close');
	closeStopVideo('.close-overlay');
	
	function autoPlayVideo (selector, videodiv) {
		$(selector).click(function() {
			let vURL = new URL($(videodiv).attr('src'));
			let vParams = vURL.searchParams;
			vParams.set('autoplay', '1');
			vURL.search = vParams.toString();
			let nURL = vURL.toString();
			$(videodiv).attr('src', nURL);
		});
	}
	
	//Walmart Wireless
	autoPlayVideo('.cards-wrapper a[data-w-id="f7ac4e51-b8ae-3de4-879d-80b8e48bd9bf"]', '.popup-video-1 iframe');
	autoPlayVideo('.cards-wrapper a[data-w-id="f7ac4e51-b8ae-3de4-879d-80b8e48bd9c6"]', '.popup-video-2 iframe');
	autoPlayVideo('.cards-wrapper a[data-w-id="f7ac4e51-b8ae-3de4-879d-80b8e48bd9cd"]', '.popup-video-3 iframe');
	//Walmart Family iPhone 7
	autoPlayVideo('.cards-wrapper a[data-w-id="10f1297f-c986-f3ad-96f0-30387389f0f5"]', '.popup-video-4 iframe');
	autoPlayVideo('.cards-wrapper a[data-w-id="ed6b80dc-830c-2bf0-1bd0-be6b17962867"]', '.popup-video-5 iframe');
	autoPlayVideo('.cards-wrapper a[data-w-id="7cc96e26-a9fb-4715-c45c-394ff41eb29a"]', '.popup-video-6 iframe');
	autoPlayVideo('.cards-wrapper a[data-w-id="8a11f9c5-9d45-79c7-ad04-b5f5ee49f40a"]', '.popup-video-7 iframe');
	autoPlayVideo('.cards-wrapper a[data-w-id="ede42583-c54b-e6f4-5c96-5b5332ea6bea"]', '.popup-video-8 iframe');
	autoPlayVideo('.cards-wrapper a[data-w-id="9a61b869-8ade-556e-59fe-4a99a7f6d6e3"]', '.popup-video-9 iframe');
	autoPlayVideo('.cards-wrapper a[data-w-id="bc03f4fe-f44f-e5b2-54f7-6e6f35b181a8"]', '.popup-video-11 iframe');
	//Walmart Family Mobile
	autoPlayVideo('.cards-wrapper a[data-w-id="19a1abf3-b2e3-09dd-6c1e-8b14f5fa3743"]', '.popup-video-4 iframe');
	autoPlayVideo('.cards-wrapper a[data-w-id="19a1abf3-b2e3-09dd-6c1e-8b14f5fa374a"]', '.popup-video-5 iframe');
	autoPlayVideo('.cards-wrapper a[data-w-id="19a1abf3-b2e3-09dd-6c1e-8b14f5fa3751"]', '.popup-video-6 iframe');
	autoPlayVideo('.cards-wrapper a[data-w-id="19a1abf3-b2e3-09dd-6c1e-8b14f5fa3758"]', '.popup-video-7 iframe');
	autoPlayVideo('.cards-wrapper a[data-w-id="cf4a2b73-b935-eaf6-72c6-996ab89bc1d8"]', '.popup-video-8 iframe');
	autoPlayVideo('.cards-wrapper a[data-w-id="e6e6de98-0b11-57c8-d0e5-4a6a21f89ff8"]', '.popup-video-9 iframe');
	autoPlayVideo('.cards-wrapper a[data-w-id="858aa1e7-05d9-0b5f-ed81-6cea8dd81fc7"]', '.popup-video-10 iframe');
	autoPlayVideo('.cards-wrapper a[data-w-id="29b38a12-0e21-a6f8-3bb6-19b780e3bf2b"]', '.popup-video-11 iframe');

	function fullScreenVideo (selector) {
		$(selector).click(function(){
			const html5video = $("#remoteVideo")[0];
			if (html5video.requestFullscreen) 
				html5video.requestFullscreen(); /* Firefox */
			else if (html5video.webkitRequestFullscreen) 
				html5video.webkitRequestFullscreen(); /* Safari */
			else if (html5video.msRequestFullScreen) 
				html5video.msRequestFullScreen(); /* Edge */
		});
	};
	fullScreenVideo('.fullscreen-on');

	$('.swipe-up-wrapper .text-block-23').text('tap for more info')
});


$(document).on('click', '.nav-menu.w-nav-menu a', function (event) {
	event.preventDefault()

	const $navLink = $(this)
	const $navOption = event.currentTarget.classList[0] || null

	if ($navOption && $navOption.includes('nav-link-')) {
		const $navItemButton = $navOption.replace('nav-link-', '')
		const $navItemModal = $navItemButton === 'basket' ? 'purchase' : $navItemButton

		if ($navLink.hasClass('active')) {
			$('.nav-menu.w-nav-menu a').removeClass('active')
			$('div[class^="tray-"].active-modal-custom').removeClass('active-modal-custom')
		} else {
			$('.nav-menu.w-nav-menu a').removeClass('active')
			$('div[class^="tray-"].active-modal-custom').removeClass('active-modal-custom')

			$navLink.addClass('active')
			$('.tray-' + $navItemModal).addClass('active-modal-custom')
		}

		if ($('.info-button .info-button-wrapper:eq(0)').hasClass('off')) {
			$('.info-button .info-button-wrapper').toggleClass('on', 'off').toggleClass('off', 'on')
		}
	}
})

$(document).on('click', 'button[class^="nav-link-"].close-btn', function () {
	$('.nav-menu.w-nav-menu a').removeClass('active')
	$('div[class^="tray-"].active-modal-custom').removeClass('active-modal-custom')
})

$(document).on('click', '.info-button', function () {
	if ($('.info-button .info-button-wrapper:eq(0)').hasClass('on')) {
		$('div[class^="tray-"].active-modal-custom').removeClass('active-modal-custom')
		$('.tray-info-2').addClass('active-modal-custom')
	} else {
		$('div[class^="tray-"].active-modal-custom').removeClass('active-modal-custom')
	}

	$('.info-button .info-button-wrapper').toggleClass('on', 'off').toggleClass('off', 'on')
})

$(document).on('click','.nav-menu a', function () {
	if($(this).hasClass('active')){
		$('.info-button').css('display', 'none')
		$('.mobileDevice .swipe-up-wrapper').css('display', 'none')
	}
	else{
		$('.info-button').css('display', 'flex')
		$('.mobileDevice .swipe-up-wrapper').css('display', 'block')
	}
});

$(document).on('click','button[class^="nav-link-"].close-btn', function () {
	$('.info-button').css('display', 'flex')
	$('.mobileDevice .swipe-up-wrapper').css('display', 'block')
});

var mediaType = null;
window.addEventListener("message", (event) => {
	let msg = event.data;
	console.log(msg)

	var remoteUrl = $("#remoteUrl");
	var remoteImg = $("#remoteImg");
	var overlayFS = $("#overlay-fs");
	


	if (msg.type === 'COD_START') {
		console.log('COD_START')
		
		switch (msg.contentType) {
			case "video": //Video
				console.log(msg.contentLink)
				remoteUrl.attr('src', msg.contentLink);
				remoteUrl[0].load();
				remoteUrl.removeClass('hide');
				try {
					remoteUrl[0].play();
				} catch (error) {
					console.error(error);
				}
				mediaType = "video";
				break;
			case "image": //Image
				console.log(msg.contentLink)
				remoteImg.attr('src', msg.contentLink);
				remoteImg.removeClass('hide');
				mediaType = "image";
				break;
			default:
				break;
		}
		overlayFS.addClass('show');

	} else if (msg.type === 'COD_STOP') {
		console.log('COD_STOP')
		switch (mediaType) {
			case "video":
				remoteUrl[0].pause();
				remoteUrl.addClass('hide');
				break;
			case "image":
				remoteImg.addClass('hide');
				break;
			default:
				break;
		}
		overlayFS.removeClass('show');

	}
	
	
}, false);

$(document).on('click', '.swipe-up-wrapper', function (event) {
	if (!$('.tray-info-2').hasClass('active-modal-custom')) {
		$('div[class^="tray-"].active-modal-custom').removeClass('active-modal-custom')
		$('.tray-info-2').addClass('active-modal-custom')

		$('.swipe-up-wrapper .text-block-23').text('tap for close info')
	} else {
		$('div[class^="tray-"].active-modal-custom').removeClass('active-modal-custom')
		$('.swipe-up-wrapper .text-block-23').text('tap for more info')
	}
})